{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "apiProfile": "2017-03-09-profile",
    "parameters": {
        "clusterName": {
            "type": "string",
            "metadata": {
                "description": "Name of the Hadoop cluster.  This must be a globally unique name."
            }
        },
        "adminUsername": {
            "type": "string",
            "metadata": {
                "description": "Cluster administrator account name."
            }
        },
        "adminPassword": {
            "type": "securestring",
            "metadata": {
                "description": "Cluster administrator account password."
            }
        },
        "storageAccountType": {
            "type": "string",
            "defaultValue": "Standard_LRS",
            "allowedValues": [
                "Standard_LRS",
                "Standard_GRS",
                "Standard_RAGRS",
                "Standard_ZRS",
                "Premium_LRS"
            ],
            "metadata": {
                "description": "Storage account type for your hadoop cluster."
            }
        },
        "masterNodeVMSize": {
            "type": "string",
            "defaultValue": "Standard_D3_v2",
            "allowedValues": [
                "Standard_D3_v2",
                "Standard_D4_v2",
                "Standard_D5_v2",
                "Standard_DS3_v2",
                "Standard_DS4_v2",
                "Standard_DS5_v2",
                "Standard_F8",
                "Standard_F16",
                "Standard_F8s",
                "Standard_F16s",
                "Standard_F8s_v2",
                "Standard_F16s_v2",
                "Standard_D12",
                "Standard_D13",
                "Standard_D12_v2",
                "Standard_D13_v2",
                "Standard_DS12_v2",
                "Standard_DS13_v2"
            ],
            "metadata": {
                "description": "The size of the virtual machine for master nodes."
            }
        },
        "workerNodeVMSize": {
            "type": "string",
            "defaultValue": "Standard_DS4_v2",
            "allowedValues": [
                "Standard_DS4_v2",
                "Standard_DS5_v2",
                "Standard_DS11_v2",
                "Standard_DS12_v2",
                "Standard_DS13_v2",
                "Standard_DS14_v2",
                "Standard_F8s_v2",
                "Standard_F8",
                "Standard_F16",
                "Standard_F16s",
                "Standard_F8s",
                "Standard_F16s_v2",
                "Standard_F32s_v2",
                "Standard_D12_v2",
                "Standard_D13_v2"
            ],
            "metadata": {
                "description": "The size of the Virtual Machine for worker nodes."
            }
        },
        "numberWorkerNodes": {
            "type": "int",
            "metadata": {
                "description": "Number of worker nodes in your system."
            }
        },
        "dataDiskSize": {
            "type": "int",
            "metadata": {
                "description": "Size of the data disks on the workers."
            }
        },
        "numberMappers": {
            "type": "int",
            "metadata": {
                "description": "Number of mappers for Terasort. This is also used to generate and validate."
            }
        },
        "numberReducers": {
            "type": "int",
            "metadata": {
                "description": "Number of reducers for Terasort. This is also used to generate and validate."
            }
        },
        "storageAccountName": {
            "type": "string",
            "metadata": {
                "description": "Storage account where results are saved."
            }
        },
        "containerName": {
            "type": "string",
            "metadata": {
                "description": "The name of the container."
            }
        },
        "pollingInterval": {
            "type": "int",
            "defaultValue": 1,
            "metadata": {
                "description": "Interval in seconds to record performance data.  Current allowed values are due to current implementation issues."
            },
            "allowedValues": [
                1,
                2,
                3,
                4,
                5,
                6,
                10,
                12,
                15,
                20,
                30,
                60
            ]
        },
        "baseURI": {
            "type": "string",
            "defaultValue": "https://raw.githubusercontent.com/deathly809/AzureStack-QuickStart-Templates/hadoop/terasort",
            "metadata": {
                "description": "Base URI where scripts are located."
            }
        },
        "batchSize": {
            "type": "int",
            "defaultValue": 10,
            "minValue": 1,
            "maxValue": 40,
            "metadata": {
                "description": "How many resources to attempt to deploy at once."
            }
        },
        "timeout": {
            "type": "int",
            "metadata": {
                "description": "Timeout in minutes before we cancel Terasort."
            }
        },
        "armEndpoint": {
            "type": "string",
            "metadata": {
                "description": "ARM Endpoint to login to."
            }
        },
        "storageEndpoint": {
            "type": "string",
            "metadata": {
                "description": "Storage endpoint for storage operations."
            }
        }
    },
    "variables": {
        "location": "[resourceGroup().location]",
        "defaultName": "[parameters('clusterName')]",
        "masters": [
            "NameNode",
            "ResourceManager",
            "JobHistory"
        ],
        "numberMasters": "[length(variables('masters'))]",
        "githubURI": "https://raw.githubusercontent.com/deathly809/AzureStack-QuickStart-Templates/hadoop/hadoop",
        "tenantId": "[subscription().tenantId]"
    },
    "resources": [
        {
            "apiVersion": "2016-02-01",
            "name": "linkedTemplate",
            "type": "Microsoft.Resources/deployments",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[concat(variables('githubURI'),'/vm-linux-hadoop.json')]",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "clusterName": {
                        "value": "[parameters('clusterName')]"
                    },
                    "adminUsername": {
                        "value": "[parameters('adminUsername')]"
                    },
                    "adminPassword": {
                        "value": "[parameters('adminPassword')]"
                    },
                    "storageAccountType": {
                        "value": "[parameters('storageAccountType')]"
                    },
                    "masterNodeVMSize": {
                        "value": "[parameters('masterNodeVMSize')]"
                    },
                    "workerNodeVMSize": {
                        "value": "[parameters('workerNodeVMSize')]"
                    },
                    "numberWorkerNodes": {
                        "value": "[parameters('numberWorkerNodes')]"
                    },
                    "dataDiskSize": {
                        "value": "[parameters('dataDiskSize')]"
                    },
                    "batchSize": {
                        "value": "[parameters('batchSize')]"
                    }
                }
            }
        },
        {
            "name": "[concat(parameters('clusterName'),variables('masters')[copyIndex()],'/certMasterCustomScript')]",
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "location": "[resourceGroup().location]",
            "copy": {
                "name": "masterInstallCerts",
                "count": "[variables('numberMasters')]"
            },
            "apiVersion": "2016-03-30",
            "tags": {
                "displayName": "Sets up the master to monitor performance."
            },
            "properties": {
                "publisher": "Microsoft.Azure.Extensions",
                "type": "CustomScript",
                "typeHandlerVersion": "2.0",
                "autoUpgradeMinorVersion": "true",
                "settings": {
                    "timestamp": 1,
                    "script": "IyEvYmluL2Jhc2gNCmNkIC92YXIvbGliL3dhYWdlbnQNCm1rZGlyIGNlcnRkaXIgLWYNCmZvciBDRVJUIGluIGBncmVwIC1sIEJhZyAqLmNydCBgOw0KZG8NCiAgICBjcCAkQ0VSVCBjZXJ0ZGlyDQpkb25lDQojDQojIExpbnV4DQojDQojICIvdXNyL2xpYi9zc2wvY2VydHMucGVtIiwgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGV1cmlzdGljDQojICIvZXRjL3NzbC9jZXJ0cy9jYS1jZXJ0aWZpY2F0ZXMuY3J0IiwgICAgICAgICAgICAgICAgLy8gRGViaWFuL1VidW50dS9HZW50b28gZXRjLg0KIyAiL2V0Yy9wa2kvdGxzL2NlcnRzL2NhLWJ1bmRsZS5jcnQiLCAgICAgICAgICAgICAgICAgIC8vIEZlZG9yYS9SSEVMIDYNCiMgIi9ldGMvc3NsL2NhLWJ1bmRsZS5wZW0iLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPcGVuU1VTRQ0KIyAiL2V0Yy9wa2kvdGxzL2NhY2VydC5wZW0iLCAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9wZW5FTEVDDQojICIvZXRjL3BraS9jYS10cnVzdC9leHRyYWN0ZWQvcGVtL3Rscy1jYS1idW5kbGUucGVtIiwgLy8gQ2VudE9TL1JIRUwgNw0KIw0KIyBVbml4IChOb3Qgc3VwcG9ydGVkKQ0KIw0KIyAiL2V0Yy9zc2wvY2VydHMiLCAgICAgICAgICAgICAgIC8vIFNMRVMxMC9TTEVTMTEsIGh0dHBzOi8vZ29sYW5nLm9yZy9pc3N1ZS8xMjEzOQ0KIyAiL3N5c3RlbS9ldGMvc2VjdXJpdHkvY2FjZXJ0cyIsIC8vIEFuZHJvaWQNCiMgIi91c3IvbG9jYWwvc2hhcmUvY2VydHMiLCAgICAgICAvLyBGcmVlQlNEDQojICIvZXRjL3BraS90bHMvY2VydHMiLCAgICAgICAgICAgLy8gRmVkb3JhL1JIRUwNCiMgIi9ldGMvb3BlbnNzbC9jZXJ0cyIsICAgICAgICAgICAvLyBOZXRCU0QNCiMNCmZvciBGIGluICouY3J0OyBkbyBvcGVuc3NsIHg1MDkgLWluICRGIC1vdXQgIiR7RiUuKn0iLnBlbSAtb3V0Zm9ybSBQRU07IGRvbmUNCmNhdCAqLnBlbSA+IHRlbXBvcmFyeS5jcnQNCmZ1bmN0aW9uIGluc3RhbGwgew0KICAgIEZST009JDA7VE89JDE7c2hpZnQ7c2hpZnQ7RlVOQ1RJT049IiRAIg0KICAgIGlmIFsgLWYgIiRUTyAiIF07IHRoZW4NCiAgICAgICAgY2F0ICRGUk9NID4+ICRUTw0KICAgICAgICAkRlVOQ1RJT04NCiAgICBmaQ0KfQ0KIyBIYWNreQ0KdG91Y2ggJy91c3IvbGliL3NzbC9jZXJ0cy5wZW0nDQppbnN0YWxsIGNlcnRkaXIvdGVtcG9yYXJ5LmNydCAnL3Vzci9saWIvc3NsL2NlcnRzLnBlbScNCiMgS25vd24gbG9jYXRpb25zDQppbnN0YWxsIGNlcnRkaXIvdGVtcG9yYXJ5LmNydCAiL2V0Yy9zc2wvY2VydHMvY2EtY2VydGlmaWNhdGVzLmNydCIgdXBkYXRlLWNhLWNlcnRpZmljYXRlcw0KaW5zdGFsbCBjZXJ0ZGlyL3RlbXBvcmFyeS5jcnQgIi9ldGMvcGtpL3Rscy9jZXJ0cy9jYS1idW5kbGUuY3J0Ig0KaW5zdGFsbCBjZXJ0ZGlyL3RlbXBvcmFyeS5jcnQgIi9ldGMvc3NsL2NhLWJ1bmRsZS5wZW0iDQppbnN0YWxsIGNlcnRkaXIvdGVtcG9yYXJ5LmNydCAiL2V0Yy9wa2kvY2EtdHJ1c3QvZXh0cmFjdGVkL3BlbS90bHMtY2EtYnVuZGxlLnBlbSIgdXBkYXRlLWNhLXRydXN0IGV4dHJhY3QNCg=="
                }
            }
        },
        {
            "name": "[concat(variables('defaultName'),'Worker',copyIndex(),'/certWorkerCustomScript')]",
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "location": "[resourceGroup().location]",
            "copy": {
                "name": "workerInstallCerts",
                "count": "[parameters('numberWorkerNodes')]"
            },
            "apiVersion": "2016-03-30",
            "tags": {
                "displayName": "Install certs on workers."
            },
            "properties": {
                "publisher": "Microsoft.Azure.Extensions",
                "type": "CustomScript",
                "typeHandlerVersion": "2.0",
                "autoUpgradeMinorVersion": "true",
                "settings": {
                    "timestamp": 1,
                    "script": "IyEvYmluL2Jhc2gNCmNkIC92YXIvbGliL3dhYWdlbnQNCm1rZGlyIGNlcnRkaXIgLWYNCmZvciBDRVJUIGluIGBncmVwIC1sIEJhZyAqLmNydCBgOw0KZG8NCiAgICBjcCAkQ0VSVCBjZXJ0ZGlyDQpkb25lDQojDQojIExpbnV4DQojDQojICIvdXNyL2xpYi9zc2wvY2VydHMucGVtIiwgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGV1cmlzdGljDQojICIvZXRjL3NzbC9jZXJ0cy9jYS1jZXJ0aWZpY2F0ZXMuY3J0IiwgICAgICAgICAgICAgICAgLy8gRGViaWFuL1VidW50dS9HZW50b28gZXRjLg0KIyAiL2V0Yy9wa2kvdGxzL2NlcnRzL2NhLWJ1bmRsZS5jcnQiLCAgICAgICAgICAgICAgICAgIC8vIEZlZG9yYS9SSEVMIDYNCiMgIi9ldGMvc3NsL2NhLWJ1bmRsZS5wZW0iLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPcGVuU1VTRQ0KIyAiL2V0Yy9wa2kvdGxzL2NhY2VydC5wZW0iLCAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9wZW5FTEVDDQojICIvZXRjL3BraS9jYS10cnVzdC9leHRyYWN0ZWQvcGVtL3Rscy1jYS1idW5kbGUucGVtIiwgLy8gQ2VudE9TL1JIRUwgNw0KIw0KIyBVbml4IChOb3Qgc3VwcG9ydGVkKQ0KIw0KIyAiL2V0Yy9zc2wvY2VydHMiLCAgICAgICAgICAgICAgIC8vIFNMRVMxMC9TTEVTMTEsIGh0dHBzOi8vZ29sYW5nLm9yZy9pc3N1ZS8xMjEzOQ0KIyAiL3N5c3RlbS9ldGMvc2VjdXJpdHkvY2FjZXJ0cyIsIC8vIEFuZHJvaWQNCiMgIi91c3IvbG9jYWwvc2hhcmUvY2VydHMiLCAgICAgICAvLyBGcmVlQlNEDQojICIvZXRjL3BraS90bHMvY2VydHMiLCAgICAgICAgICAgLy8gRmVkb3JhL1JIRUwNCiMgIi9ldGMvb3BlbnNzbC9jZXJ0cyIsICAgICAgICAgICAvLyBOZXRCU0QNCiMNCmZvciBGIGluICouY3J0OyBkbyBvcGVuc3NsIHg1MDkgLWluICRGIC1vdXQgIiR7RiUuKn0iLnBlbSAtb3V0Zm9ybSBQRU07IGRvbmUNCmNhdCAqLnBlbSA+IHRlbXBvcmFyeS5jcnQNCmZ1bmN0aW9uIGluc3RhbGwgew0KICAgIEZST009JDA7VE89JDE7c2hpZnQ7c2hpZnQ7RlVOQ1RJT049IiRAIg0KICAgIGlmIFsgLWYgIiRUTyAiIF07IHRoZW4NCiAgICAgICAgY2F0ICRGUk9NID4+ICRUTw0KICAgICAgICAkRlVOQ1RJT04NCiAgICBmaQ0KfQ0KIyBIYWNreQ0KdG91Y2ggJy91c3IvbGliL3NzbC9jZXJ0cy5wZW0nDQppbnN0YWxsIGNlcnRkaXIvdGVtcG9yYXJ5LmNydCAnL3Vzci9saWIvc3NsL2NlcnRzLnBlbScNCiMgS25vd24gbG9jYXRpb25zDQppbnN0YWxsIGNlcnRkaXIvdGVtcG9yYXJ5LmNydCAiL2V0Yy9zc2wvY2VydHMvY2EtY2VydGlmaWNhdGVzLmNydCIgdXBkYXRlLWNhLWNlcnRpZmljYXRlcw0KaW5zdGFsbCBjZXJ0ZGlyL3RlbXBvcmFyeS5jcnQgIi9ldGMvcGtpL3Rscy9jZXJ0cy9jYS1idW5kbGUuY3J0Ig0KaW5zdGFsbCBjZXJ0ZGlyL3RlbXBvcmFyeS5jcnQgIi9ldGMvc3NsL2NhLWJ1bmRsZS5wZW0iDQppbnN0YWxsIGNlcnRkaXIvdGVtcG9yYXJ5LmNydCAiL2V0Yy9wa2kvY2EtdHJ1c3QvZXh0cmFjdGVkL3BlbS90bHMtY2EtYnVuZGxlLnBlbSIgdXBkYXRlLWNhLXRydXN0IGV4dHJhY3QNCg=="
                }
            }
        },
        {
            "name": "[concat(variables('defaultName'),'Jumpbox/certJumpboxCustomScript')]",
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "location": "[resourceGroup().location]",
            "apiVersion": "2016-03-30",
            "tags": {
                "displayName": "Install certs on JumpBox."
            },
            "properties": {
                "publisher": "Microsoft.Azure.Extensions",
                "type": "CustomScript",
                "typeHandlerVersion": "2.0",
                "autoUpgradeMinorVersion": "true",
                "settings": {
                    "timestamp": 1,
                    "script": "IyEvYmluL2Jhc2gNCmNkIC92YXIvbGliL3dhYWdlbnQNCm1rZGlyIGNlcnRkaXIgLWYNCmZvciBDRVJUIGluIGBncmVwIC1sIEJhZyAqLmNydCBgOw0KZG8NCiAgICBjcCAkQ0VSVCBjZXJ0ZGlyDQpkb25lDQojDQojIExpbnV4DQojDQojICIvdXNyL2xpYi9zc2wvY2VydHMucGVtIiwgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGV1cmlzdGljDQojICIvZXRjL3NzbC9jZXJ0cy9jYS1jZXJ0aWZpY2F0ZXMuY3J0IiwgICAgICAgICAgICAgICAgLy8gRGViaWFuL1VidW50dS9HZW50b28gZXRjLg0KIyAiL2V0Yy9wa2kvdGxzL2NlcnRzL2NhLWJ1bmRsZS5jcnQiLCAgICAgICAgICAgICAgICAgIC8vIEZlZG9yYS9SSEVMIDYNCiMgIi9ldGMvc3NsL2NhLWJ1bmRsZS5wZW0iLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPcGVuU1VTRQ0KIyAiL2V0Yy9wa2kvdGxzL2NhY2VydC5wZW0iLCAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9wZW5FTEVDDQojICIvZXRjL3BraS9jYS10cnVzdC9leHRyYWN0ZWQvcGVtL3Rscy1jYS1idW5kbGUucGVtIiwgLy8gQ2VudE9TL1JIRUwgNw0KIw0KIyBVbml4IChOb3Qgc3VwcG9ydGVkKQ0KIw0KIyAiL2V0Yy9zc2wvY2VydHMiLCAgICAgICAgICAgICAgIC8vIFNMRVMxMC9TTEVTMTEsIGh0dHBzOi8vZ29sYW5nLm9yZy9pc3N1ZS8xMjEzOQ0KIyAiL3N5c3RlbS9ldGMvc2VjdXJpdHkvY2FjZXJ0cyIsIC8vIEFuZHJvaWQNCiMgIi91c3IvbG9jYWwvc2hhcmUvY2VydHMiLCAgICAgICAvLyBGcmVlQlNEDQojICIvZXRjL3BraS90bHMvY2VydHMiLCAgICAgICAgICAgLy8gRmVkb3JhL1JIRUwNCiMgIi9ldGMvb3BlbnNzbC9jZXJ0cyIsICAgICAgICAgICAvLyBOZXRCU0QNCiMNCmZvciBGIGluICouY3J0OyBkbyBvcGVuc3NsIHg1MDkgLWluICRGIC1vdXQgIiR7RiUuKn0iLnBlbSAtb3V0Zm9ybSBQRU07IGRvbmUNCmNhdCAqLnBlbSA+IHRlbXBvcmFyeS5jcnQNCmZ1bmN0aW9uIGluc3RhbGwgew0KICAgIEZST009JDA7VE89JDE7c2hpZnQ7c2hpZnQ7RlVOQ1RJT049IiRAIg0KICAgIGlmIFsgLWYgIiRUTyAiIF07IHRoZW4NCiAgICAgICAgY2F0ICRGUk9NID4+ICRUTw0KICAgICAgICAkRlVOQ1RJT04NCiAgICBmaQ0KfQ0KIyBIYWNreQ0KdG91Y2ggJy91c3IvbGliL3NzbC9jZXJ0cy5wZW0nDQppbnN0YWxsIGNlcnRkaXIvdGVtcG9yYXJ5LmNydCAnL3Vzci9saWIvc3NsL2NlcnRzLnBlbScNCiMgS25vd24gbG9jYXRpb25zDQppbnN0YWxsIGNlcnRkaXIvdGVtcG9yYXJ5LmNydCAiL2V0Yy9zc2wvY2VydHMvY2EtY2VydGlmaWNhdGVzLmNydCIgdXBkYXRlLWNhLWNlcnRpZmljYXRlcw0KaW5zdGFsbCBjZXJ0ZGlyL3RlbXBvcmFyeS5jcnQgIi9ldGMvcGtpL3Rscy9jZXJ0cy9jYS1idW5kbGUuY3J0Ig0KaW5zdGFsbCBjZXJ0ZGlyL3RlbXBvcmFyeS5jcnQgIi9ldGMvc3NsL2NhLWJ1bmRsZS5wZW0iDQppbnN0YWxsIGNlcnRkaXIvdGVtcG9yYXJ5LmNydCAiL2V0Yy9wa2kvY2EtdHJ1c3QvZXh0cmFjdGVkL3BlbS90bHMtY2EtYnVuZGxlLnBlbSIgdXBkYXRlLWNhLXRydXN0IGV4dHJhY3QNCg=="
                }
            }
        },
        {
            "comments": "Storage account which holds all performance data.",
            "type": "Microsoft.Storage/storageAccounts",
            "name": "[toLower(parameters('storageAccountName'))]",
            "apiVersion": "2016-01-01",
            "location": "[variables('location')]",
            "dependsOn": [
                "linkedTemplate"
            ],
            "properties": {
                "accountType": "[parameters('storageAccountType')]"
            }
        },
        {
            "name": "[concat(parameters('clusterName'),variables('masters')[copyIndex()],'/masterCustomScript')]",
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "linkedTemplate"
            ],
            "copy": {
                "name": "masterTerasortPrepare",
                "count": "[variables('numberMasters')]"
            },
            "apiVersion": "2016-03-30",
            "tags": {
                "displayName": "Install certs on master."
            },
            "properties": {
                "publisher": "Microsoft.Azure.Extensions",
                "type": "CustomScript",
                "typeHandlerVersion": "2.0",
                "autoUpgradeMinorVersion": "true",
                "settings": {
                    "timestamp": 2,
                    "fileUris": [
                        "[concat(parameters('baseURI'),'/prepareTerasort.sh')]"
                    ],
                    "commandToExecute": "[concat('bash prepareTerasort.sh',' ',parameters('adminUsername'),' ',parameters('adminPassword'),' ',variables('tenantId'),' ',parameters('armEndpoint'),parameters('storageEndpoint'),' ',' ',parameters('storageAccountName'),' ',parameters('containerName'),' ',parameters('pollingInterval'),' ',parameters('timeout'))]"
                }
            }
        },
        {
            "name": "[concat(variables('defaultName'),'Worker',copyIndex(),'/workerCustomScript')]",
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "linkedTemplate"
            ],
            "copy": {
                "name": "workerTerasortPrepare",
                "count": "[parameters('numberWorkerNodes')]"
            },
            "apiVersion": "2016-03-30",
            "tags": {
                "displayName": "Sets up the worker to monitor performance."
            },
            "properties": {
                "publisher": "Microsoft.Azure.Extensions",
                "type": "CustomScript",
                "typeHandlerVersion": "2.0",
                "autoUpgradeMinorVersion": "true",
                "settings": {
                    "timestamp": 2,
                    "fileUris": [
                        "[concat(parameters('baseURI'),'/prepareTerasort.sh')]"
                    ],
                    "commandToExecute": "[concat('bash prepareTerasort.sh',' ',parameters('adminUsername'),' ',parameters('adminPassword'),' ',variables('tenantId'),' ',parameters('armEndpoint'),parameters('storageEndpoint'),' ',' ',parameters('storageAccountName'),' ',parameters('containerName'),' ',parameters('pollingInterval'),' ',parameters('timeout'))]"
                }
            }
        },
        {
            "name": "[concat(variables('defaultName'),'Jumpbox/jumpboxCustomScript')]",
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "masterTerasortPrepare",
                "workerTerasortPrepare"
            ],
            "apiVersion": "2016-03-30",
            "tags": {
                "displayName": "Executes Terasort from the Jumpbox."
            },
            "properties": {
                "publisher": "Microsoft.Azure.Extensions",
                "type": "CustomScript",
                "typeHandlerVersion": "2.0",
                "autoUpgradeMinorVersion": "true",
                "settings": {
                    "timestamp": 2,
                    "fileUris": [
                        "[concat(parameters('baseURI'),'/runTerasort.sh')]"
                    ],
                    "commandToExecute": "[concat('bash runTerasort.sh',' ',parameters('adminUsername'),' ',parameters('adminPassword'),' ',parameters('numberMappers'),' ',parameters('numberReducers'),' ',parameters('timeout'),' ',variables('tenantId'),' ',parameters('storageAccountName'),' ',parameters('containerName'),' ',parameters('armEndpoint'),' ',parameters('storageEndpoint'))]"
                }
            }
        }
    ],
    "outputs": {}
}
